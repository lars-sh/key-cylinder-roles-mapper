<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>KeyCylinderRolesMapperCli.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Key Cylinder Roles Mapper</a> &gt; <a href="index.source.html" class="el_package">de.larssh.keycylinderroles.mapper.cli</a> &gt; <span class="el_source">KeyCylinderRolesMapperCli.java</span></div><h1>KeyCylinderRolesMapperCli.java</h1><pre class="source lang-java linenums">// Generated by delombok at Mon Feb 16 00:29:52 UTC 2026
package de.larssh.keycylinderroles.mapper.cli;

import java.io.IOException;
import java.io.PrintWriter;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.LinkedHashSet;
import java.util.Set;
import java.util.concurrent.Callable;
import java.util.jar.Attributes.Name;
import org.apache.poi.poifs.filesystem.FileMagic;
import de.larssh.keycylinderroles.mapper.data.Cylinder;
import de.larssh.keycylinderroles.mapper.data.Key;
import de.larssh.keycylinderroles.mapper.data.KeyCylinderPermissions;
import de.larssh.keycylinderroles.mapper.sheets.csv.CsvFiles;
import de.larssh.keycylinderroles.mapper.sheets.excel.ExcelFiles;
import de.larssh.utils.Nullables;
import de.larssh.utils.io.Resources;
import de.larssh.utils.text.StringParseException;
import edu.umd.cs.findbugs.annotations.Nullable;
import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
import picocli.CommandLine;
import picocli.CommandLine.Command;
import picocli.CommandLine.ExitCode;
import picocli.CommandLine.IVersionProvider;
import picocli.CommandLine.Model.CommandSpec;
import picocli.CommandLine.Parameters;
import picocli.CommandLine.Spec;

/**
 * The CLI interface of the Key Cylinder Roles Mapper
 */
@Command(name = &quot;key-cylinder-roles-mapper&quot;, mixinStandardHelpOptions = true, showDefaultValues = true, usageHelpWidth = 160, versionProvider = KeyCylinderRolesMapperCli.class)
public class KeyCylinderRolesMapperCli implements Callable&lt;Integer&gt;, IVersionProvider {
	/**
	 * The CLI interface of the Key Cylinder Roles Mapper
	 *
	 * @param args CLI arguments
	 */
	@SuppressWarnings(&quot;checkstyle:UncommentedMain&quot;)
	public static void main(final String... args) {
<span class="nc" id="L43">		System.exit(new CommandLine(new KeyCylinderRolesMapperCli()).execute(args));</span>
<span class="nc" id="L44">	}</span>

	/**
	 * Current {@link CommandSpec} instance
	 */
	@Spec
	@Nullable
	private CommandSpec commandSpec;
	@Parameters(descriptionKey = &quot;SOURCE&quot;)
	private Path source = Paths.get(&quot;&quot;);
	@Parameters(descriptionKey = &quot;DESTINATION&quot;)
	private Path destination = Paths.get(&quot;&quot;);

	@Override
	public Integer call() throws IOException, StringParseException {
<span class="nc" id="L59">		final KeyCylinderPermissions sourcePermissions = read(getSource());</span>
<span class="nc" id="L60">		final KeyCylinderPermissions destinationPermissions = read(getDestination());</span>
<span class="nc" id="L61">		comparePermissions(sourcePermissions, destinationPermissions);</span>
<span class="nc" id="L62">		return ExitCode.OK;</span>
	}

	private KeyCylinderPermissions read(final Path path) throws IOException {
<span class="nc" id="L66">		return  //</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">		FileMagic.valueOf(path.toFile()) == FileMagic.UNKNOWN ? CsvFiles.read(path) : ExcelFiles.read(path);</span>
	}

	@SuppressWarnings({&quot;checkstyle:SuppressWarnings&quot;, &quot;PMD.AvoidDeeplyNestedIfStmts&quot;, &quot;PMD.CognitiveComplexity&quot;, &quot;resource&quot;})
	private void comparePermissions(final KeyCylinderPermissions source, final KeyCylinderPermissions destination) {
<span class="nc" id="L72">		final Set&lt;Key&gt; keys = new LinkedHashSet&lt;&gt;(source.getKeys());</span>
<span class="nc" id="L73">		keys.addAll(destination.getKeys());</span>
<span class="nc" id="L74">		final Set&lt;Cylinder&gt; cylinders = new LinkedHashSet&lt;&gt;(source.getCylinders());</span>
<span class="nc" id="L75">		cylinders.addAll(destination.getCylinders());</span>
<span class="nc" id="L76">		int count = 0;</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">		for (final Key key : keys) {</span>
<span class="nc bnc" id="L78" title="All 4 branches missed.">			if (!source.isIgnore(key) &amp;&amp; !destination.isIgnore(key)) {</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">				for (final Cylinder cylinder : cylinders) {</span>
<span class="nc bnc" id="L80" title="All 4 branches missed.">					if (!source.isIgnore(cylinder) &amp;&amp; !destination.isIgnore(cylinder)) {</span>
<span class="nc" id="L81">						final boolean sourceAllows = source.allows(key, cylinder);</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">						if (sourceAllows != destination.allows(key, cylinder)) {</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">							final String format = sourceAllows ? &quot;ALT: \&quot;%s\&quot; (%s) soll nicht l√§nger auf \&quot;%s\&quot; (%s) berechtigt sein.&quot; : &quot;NEU: \&quot;%s\&quot; (%s) soll jetzt auf \&quot;%s\&quot; (%s) berechtigt werden.&quot;;</span>
<span class="nc" id="L84">							final Key outputKey = destination.get(key).orElse(key);</span>
<span class="nc" id="L85">							final Cylinder outputCylinder = destination.get(cylinder).orElse(cylinder);</span>
<span class="nc" id="L86">							getStandardOutputWriter().println(String.format(format, outputKey.getTitle(), outputKey.getId(), outputCylinder.getTitle(), outputCylinder.getId()));</span>
<span class="nc" id="L87">							count += 1;</span>
						}
					}
<span class="nc" id="L90">				}</span>
			}
<span class="nc" id="L92">		}</span>
<span class="nc" id="L93">		getStandardOutputWriter().println(String.format(&quot;%d Unterschiede gefunden.&quot;, count));</span>
<span class="nc" id="L94">	}</span>

	private CommandSpec getCommandSpec() {
<span class="nc" id="L97">		return Nullables.orElseThrow(commandSpec);</span>
	}

	/**
	 * Returns the standard output writer based on the current {@link CommandSpec}.
	 *
	 * @return the standard output writer
	 */
	private PrintWriter getStandardOutputWriter() {
<span class="nc" id="L106">		return getCommandSpec().commandLine().getOut();</span>
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public String[] getVersion() throws IOException {
<span class="nc" id="L114">		return new String[] {Resources.readManifest(getClass()).map(manifest -&gt; manifest.getMainAttributes().get(Name.IMPLEMENTATION_VERSION).toString()).orElse(&quot;unknown&quot;)};</span>
	}

	/**
	 * Dummy to avoid the IDE to mark some fields as {@code final}.
	 */
	@SuppressWarnings(&quot;PMD.UnusedPrivateMethod&quot;)
	@SuppressFBWarnings(value = &quot;UPM_UNCALLED_PRIVATE_METHOD&quot;, justification = &quot;dummy method&quot;)
	private void nonFinalDummy() {
<span class="nc" id="L123">		source = Paths.get(&quot;&quot;);</span>
<span class="nc" id="L124">		destination = source;</span>
<span class="nc" id="L125">	}</span>

	@java.lang.SuppressWarnings(&quot;all&quot;)
	@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(justification = &quot;generated code&quot;)
	@lombok.Generated
	public Path getSource() {
		return this.source;
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
	@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(justification = &quot;generated code&quot;)
	@lombok.Generated
	public Path getDestination() {
		return this.destination;
	}

	@java.lang.SuppressWarnings(&quot;all&quot;)
	@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(justification = &quot;generated code&quot;)
	@lombok.Generated
	public KeyCylinderRolesMapperCli() {
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>